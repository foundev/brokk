<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Brokk MOP - Dev Mode</title>
</head>
<style>


  @import url('https://fonts.googleapis.com/css?family=Raleway:400,400i,500,500i,600,600i,700,700i');

  html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
    margin: 0;
    padding: 0;
    border: 0;
    font: inherit;
    font-size: 100%;
    vertical-align: baseline
  }

  html {
    line-height: 1
  }

  ol,
  ul {
    list-style: none
  }

  table {
    border-collapse: collapse;
    border-spacing: 0
  }

  caption,
  th,
  td {
    text-align: left;
    font-weight: normal;
    vertical-align: middle
  }

  q,
  blockquote {
    quotes: none
  }

  q:before,
  q:after,
  blockquote:before,
  blockquote:after {
    content: "";
    content: none
  }

  a img {
    border: none
  }

  article, aside, details, figcaption, figure, footer, header, hgroup, main, menu, nav, section, summary {
    display: block
  }

  * {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box
  }

  html {
    font-size: 16px;
    line-height: 1.6em;
    -webkit-text-size-adjust: 100%
  }


  body {
    background-color: #fff;
    color: #545454;

    font-family: "Raleway", sans-serif;
    text-rendering: optimizeLegibility;

    margin: 2em auto;

    padding: 1.6em 3.15em;
  }


  h1 {
    font-family: "Raleway", sans-serif;
    font-weight: 700;
    color: #333;
    font-size: 1.6em;
    line-height: 1.3em;
    margin-bottom: .78571em
  }

  h2 {
    font-family: "Raleway", sans-serif;
    font-weight: 600;
    color: #333;
    font-size: 1.3em;
    line-height: 1em;
    margin-top: 2em;
    margin-bottom: .6em
  }

  h3 {
    font-family: "Raleway", sans-serif;
    font-weight: 600;
    color: #333;
    font-size: 1.15em;
    line-height: 1em;
    margin-top: 1em;
    margin-bottom: .6em
  }

  h4 {
    font-family: "Raleway", sans-serif;
    font-weight: 500;
    color: #333;
    font-size: 1em;
    line-height: 1em;
    margin-top: 1em;
    margin-bottom: .6em
  }



  p {
    margin-bottom: 1.57143em;
    hyphens: auto
  }


  b, strong {
    font-family: "Raleway", sans-serif;
    font-weight: 700;
  }

  i, em {
    font-family: "Raleway", sans-serif;
    font-style: italic;
  }

  u {
    text-decoration: none;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0) 50%, #e06e73 50%);
    background-repeat: repeat-x;
    background-size: 2px 2px;
    background-position: 0 1.05em
  }

  s {
    color: #878787
  }


  a {
    color: #e74c3c;
    text-decoration: none
  }

  img {
    max-width: 100%;
    height: auto
  }

  blockquote {
    display: block;
    margin-left: -1em;
    padding-left: 0.8em;
    border-left: 0.2em solid #e74c3c;
    background-color: transparent;
  }

  hr {
    height: 1px;
    border: 0;
    background-color: #dedede;
    margin: .7em auto .7em
  }

  /* LISTS */

  ul li {
    text-indent: -0.45em
  }

  ul li:before {
    content: "•";
    color: #e74c3c;
    display: inline-block;
    margin-right: 0.3em;
    font-size: 1.5em;
    vertical-align: middle;
  }

  ul ul {
    margin-left: 1.25714em
  }

  ol li {
    text-indent: -1.45em
  }

  ol ol {
    margin-left: 1.25714em
  }

  ul, ol {
    margin-bottom: 1.5em;
  }

  ul ul, ul ol,
  ol ul, ol ol {
    margin-bottom: 0;
  }

  ol {
    counter-reset: ol;
  }

  ol li {
    counter-increment: ol;
  }

  ol li:before {
    content: counter(ol) ".";
    color: #e06e73;
    text-align: right;
    display: inline-block;
    min-width: 1em;
    margin-right: 0.5em
  }

  ol li p {
    display: inline;
  }

  /* CODE */
  code {
    display: inline;
    background: #fcfcfc;
    border: 1px solid #dedede;
    border-radius: .3em;
    padding: 0.2em 0.5em;
    font-family: "Fira Code Retina", monospace;
    font-size: 0.7em;
  }

  pre {
    display: block;
    background: transparent;
    padding: 0;
    margin: 0;
  }

  pre code {
    display: block;
    width: 100%;
    line-height: 1.45em;

    padding: 1.2em 1em;
    margin: 0 0 1.5em;
  }

  .hljs {
    padding: 0;
  }

  /* TODO LIST */

  input[type="checkbox"] {
    position: relative;
    width: 1rem;
    height: 1rem;
    background: white;
    -webkit-appearance: none;
    border: 1px solid #ccc;
    border-radius: .2em;
    margin: 0.2em .5em 0em -1.7em;
    margin-bottom: .5em;
    display: block;
    float: left;
    page-break-after: avoid;
  }

  input[type="checkbox"]:checked::before {
    display: block;
    content: '✓';
    display: initial;
    font-size: 1.1em;
    font-weight: bold;
    color: #e06e73;
    position: absolute;
    left: .1em;
    bottom: -0.2em;
  }

  input[type="checkbox"] ~ label {
    display: block;
    width: 100%;
    margin-bottom: 0.1em;
  }

  ul li input[type="checkbox"] {
    font: none;
  }

  ul li input[type="checkbox"] ~ label {
    display: inline-block;
    width: auto;
    margin-bottom: 0.1em;
    margin-left: 0.5em;
  }

  /*  TABLE */

  table {
    width: calc(100% + 3em);
    margin-bottom: 1.5em;
    margin-left: -1.5em;
  }

  table tr {
    border-bottom: 1px solid #dedede;
  }

  table th {
    font-weight: 700;
  }

  table td, table th {
    vertical-align: top;
    padding: .2em 1.5em;
    font-size: .95em
  }

  thead tr {
    border-bottom: 4px double #dedede;
  }

</style>
<body>
  <h1>Brokk MOP - Development Mode</h1>
  <p>Events from Java will be logged to the console and displayed raw below.</p>
    <h3>Dev Tools</h3>
    <button onclick="simulateAskResponse()">Simulate Ask Response</button>
    <button onclick="simulateEvent('theme', { dark: !document.body.classList.contains('theme-dark') })">Toggle Theme</button>
    <button onclick="simulateEvent('clear')">Clear Log</button>
    <button onclick="simulateEvent('spinner', { message: 'Testing spinner...' }); setTimeout(() => simulateEvent('spinner', { message: '' }), 2000);">Test Spinner</button>
  </div>
  <script type="module" src="/src/index.js"></script>
  <script>
    // Immediately define brokk with a buffer to catch early events from Java
    window.brokk = {
      _eventBuffer: [],
      onEvent: function(payload) {
        console.log('Buffering early event from Java:', payload);
        window.brokk._eventBuffer.push(payload);
      }
    };
    // Mock Java bridge for dev mode
    window.javaBridge = {
      onAck: (epoch) => console.log('Mock ACK for epoch:', epoch)
    };
    
    function simulateEvent(type, data = {}) {
      window.brokk.onEvent({ type, epoch: Date.now(), ...data });
    }
    
    function simulateAskResponse() {
      const content = `"npm run dev" should run vite/svelte based on dev.html

### Why Vite is showing *index.html* even though you have *dev.html*

1. **Vite’s default entry point**  
   When you execute \`vite\` (or \`vite --port 5173\`) the dev-server looks in the project root for \`index.html\`.  
   Any other HTML files (e.g. \`dev.html\`) are still reachable at \`http://localhost:5173/dev.html\`, but the page that Vite *automatically* opens in the browser (or shows when you visit the bare root \`/\`) is always \`index.html\` unless you change either:
   - the **root directory**, or
   - the **page that the browser is told to open**.

2. **Where your files live**  
   Your tree is:

   \`\`\`
   frontend-mop/
     dev.html          ← dev-only page
     index.html        ← production entry
     vite.config.mjs
     src/
   \`\`\`

   That means:
   - Production build (\`vite build\`) will read *index.html* (because that is Vite convention when \`root\` is the repo root).
   - Dev server (\`vite\`) will also treat *index.html* as the “home page”, while *dev.html* is reachable as a secondary route.

### Options to make \`npm run dev\` “start with” \`dev.html\`

| Option | What you change | Pros | Cons |
|--------|-----------------|------|------|
| 1. Add a query to the \`open\` option | vite.config.mjs<br>\`server: { open: '/dev.html' }\` | Zero CLI changes; auto-opens correct page | Still serves \`index.html\` at \`/\`; not ideal if you *never* want \`index.html\` in dev |
| 2. Modify the npm script | \`"dev": "vite --open /dev.html"\` | No config file edits | Same caveat as above |
| 3. Point the dev server at a different **root** | Create \`frontend-mop/dev/\` and move/rename files so *dev.html* becomes \`dev/index.html\` and set \`root: 'dev'\` just for the dev command (e.g. with a second Vite config) | Clean separation of dev vs prod HTML | Requires file moves or a second config file |
| 4. Symlink or rename | Temporarily rename \`dev.html\` → \`index.html\` when in dev (via a pre-dev script) | Works with zero Vite tweaks | Adds build-step complexity / brittle |

### Minimal, lowest-friction fix

Add a small dev-only section to \`vite.config.mjs\`:

\`\`\`js
import { defineConfig } from 'vite'
import { svelte } from '@sveltejs/vite-plugin-svelte'

export default defineConfig(({ command }) => ({
  plugins: [svelte()],
  build: {
    outDir: '../src/main/resources/mop-web',
    emptyOutDir: true
  },
  // Only for \`vite dev\`
  server: {
    port: 5173,
    // Open /dev.html instead of /
    open: command === 'serve' ? '/dev.html' : undefined
  }
}))
\`\`\`

Or if you prefer not to touch \`vite.config.mjs\`, simply update the npm script:

\`\`\`json
"scripts": {
  "dev": "vite --port 5173 --open /dev.html",
  ...
}
\`\`\`

Both approaches:

1. Keep production build logic intact (still builds from \`index.html\`).
2. Automatically open \`http://localhost:5173/dev.html\` whenever you run \`npm run dev\`.
3. Still allow visiting \`index.html\` by typing the full URL if ever needed.

### Key takeaway

- Vite always *serves* every HTML file under \`root\`, but it *opens* only one page at start-up.
- Adjusting \`server.open\` (or the CLI \`--open\`) lets you point dev mode to whichever HTML file you want without disturbing the production build.
`;
      const chunks = content.match(/[\s\S]{1,10}/g) || [];
      let index = 0;
      simulateEvent('clear');
      const interval = setInterval(() => {
        if (index < chunks.length) {
          simulateEvent('chunk', { text: chunks[index] });
          index++;
        } else {
          clearInterval(interval);
        }
      }, 100);
    }
  </script>
</body>
</html>
